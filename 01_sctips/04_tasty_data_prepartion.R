# Tasty data preparation


# 0. Prepare environme
source("01_sctips/00_utils.R")

# 1. Load data

## 1.1. Cooked data
a0_cooked <- read_sheet(
  ss = data_lake,
  sheet = "02_cooked_data")

## 1.2. Cooked dictionary
  z0_dictionary <- 
  read_sheet(
    ss = data_lake,
    sheet = "00b_cooked_data_dictionary")



# 3. Table diferenciation ----
b0_wrokers <- 1

## 3.1. Workers cooked

## 3.2. Employers cooked ----
c0_employers <- a0_cooked %>% 
  ### Filter just empoyers
  filter(TI01_tipo == "BS - Empleador/a") %>% 
  ### Select employers' variables
  select(z0_dictionary$index[z0_dictionary$employers==T]) %>%
  ### Reset names with the dictionary
  setNames(z0_dictionary$final_employer[z0_dictionary$employers==T]) %>% 
  ### Reorder variables
  select(
    starts_with(paste(
      # Survey metadata
      paste0("sm",str_pad(paste0(0:20),2, pad = "0"), sep = "|"),
      # Identification
      paste0("id",str_pad(paste0(0:20),2, pad = "0"), sep = "|"),
      # Employer information
      paste0("ei",str_pad(paste0(0:20),2, pad = "0"), sep = "|"),
      # Employer demographics
      paste0("ed",str_pad(paste0(0:20),2, pad = "0"), sep = "|"),
      # Employer economics
      paste0("ee",str_pad(paste0(0:20),2, pad = "0"), sep = "|"),
      # Willines to pay
      paste0("wp",str_pad(paste0(0:20),2, pad = "0"), sep = "|"),
      # Employer knlowledge
      paste0("ek",str_pad(paste0(0:20),2, pad = "0"), sep = "|"),
      sep = "",collapse = "|")),
      everything())


unique(a0_cooked$TI01_tipo)  
  
# La edad debe ser puesta en "wd03_age" y "ed03_age"

str_pad(paste0(0:10),"0")
paste("sm",str_pad(paste0(0:20),2, pad = "0"),sep = "", collapse = "|")


