# Reporte
library(dplyr)
library(googlesheets4)
library(stringr)


# 0. load information ----

## 0.1. Surveys ----
a0_raw_sourvey <- read_sheet("https://docs.google.com/spreadsheets/d/12Y2I-DBsfwJPKXRQvZ730ALZKfv2OcQjI8dxisFHxqY/edit?usp=sharing") %>% 
  # Initial editions
  mutate(Timestamp = as.Date(as.character(Timestamp))) %>% 
  select(-82,-93,-107,-114,-118,-122,-123,-146,-158,-162,-163,-164,-165,-166,-167) %>% 
  mutate(across(c(3,5,7,23,25,33,42,86,87,93,114,117,118,137),~as.character(.))) 

# renaming variables
names(a0_raw_sourvey) <- read.csv(
  "00_basic_data/0. Diccionario de variables.csv",
  header = T)[,2]


## 0.2. Informed consent ----
b0_raw_consent <-
  read_sheet("https://docs.google.com/spreadsheets/d/1ln3AgV-08vaP1RKeRtaXzqIk8jQuC0fR2OXuyFBMt4M/edit?usp=sharing") %>% 
  as.data.frame() %>%  rename(ID_estudiante = Número)





# 1. Separate cohorts ----
## 1.1. First round ----
a11_old <- a0_raw_sourvey %>% filter(Fecha_captura < as.Date("2022-08-10")) %>% 
  mutate(across(1:ncol(a0_raw_sourvey),~as.character(.))) %>% 
  select(ID_estudiante,estu_nombre,estu_apellidos,estu_clase,TI01_tipo,
         ID_trabajador,ID_trabajador_R,ID_empleador,ID_subordinado,ID_subordinado_R)

## 1.2. Second round ----
a12_new <- a0_raw_sourvey %>% filter(Fecha_captura >= as.Date("2022-08-10")) %>%
  mutate(across(1:ncol(a0_raw_sourvey),~as.character(.))) %>% 
  select(ID_estudiante,estu_nombre,estu_apellidos,estu_clase,TI01_tipo,
         ID_trabajador,ID_trabajador_R,ID_empleador,ID_subordinado,ID_subordinado_R)




















a1_cooked <- a0_raw %>% 
  # Transformar variables-lista
  mutate(across(c(3,5,7,23,25,33,42,86,87,93,114,117,118,137),~as.character(.))) %>% 
  
  
  select(Timestamp,
         apellidos = `XX01: Primer apellido del estudiante/encuestador`,
         nombre = `XX02: Nombres del estudiante/encuestador`,
         id.estudiante = `XX03: Documento del estudiante/encuestador`,
         clase  =`XX04: Clase`,
         type = `TI01_tipo: Qué tipo de sujeto va a encuestar`)




  filter(Timestamp >= as.Date("2022-08-10"))






pr <- data.frame(
  col = numeric(),
  var = character(),
  class = character())

for (i in 1:ncol(a0_raw_sourvey)) {
  
  pr <- rbind(pr,
    data.frame(
      col = i,
      var = names(a0_raw_sourvey)[i],
      class =
    class(a0_raw_sourvey[[i]]))) %>% 
    filter(class == "list")
    
}
